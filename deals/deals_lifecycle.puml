@startuml
!pragma layout smetana
title Zoho CRM – Deals Module: Full DOM + Business + Automation Lifecycle
skinparam backgroundColor #FAFAFA
skinparam state {
  BackgroundColor #E8F4FD
  BorderColor #2E86AB
  FontSize 12
}
skinparam ArrowColor #2E86AB
skinparam NoteBackgroundColor #FFF8DC
skinparam NoteBorderColor #DAA520
' ─────────────────────────────────────────────
' TOP-LEVEL ENTRY
' ─────────────────────────────────────────────
[*] --> ModuleLoad : Navigate to /tab/Potentials
state ModuleLoad {
  [*] --> RenderListView
  note right of ModuleLoad
    Internal CRM module name: Potentials
    Display name: Deals
    URL: /crm/orgXXX/tab/Potentials
  end note
}
ModuleLoad --> DealsListView
' ─────────────────────────────────────────────
' STATE: DEALS LIST VIEW
' ─────────────────────────────────────────────
state DealsListView {
  ' ── LEFT NAVIGATION ───────────────────────
  state LeftNavigation {
    state "Home" as NavHome
    state "Reports" as NavReports
    state "Analytics" as NavAnalytics
    state "My Requests" as NavMyRequests
    state "CRM Teamspace" as NavTeamspace
    state "Leads" as NavLeads
    state "Workqueue" as NavWorkqueue
    state "Contacts" as NavContacts
    state "Accounts" as NavAccounts
    state "Deals (active)" as NavDeals
    state "Projects Portfolio" as NavProjects
    state "Employee Portfolio" as NavEmployee
    state "Customer Feedback" as NavCustomerFB
    state "Tasks" as NavTasks
    state "Meetings" as NavMeetings
    state "Calls" as NavCalls
    state "Prospecting Leads" as NavProspecting
    state "Logs" as NavLogs
    state "Scheduler" as NavScheduler
    state "Voice of the Customer" as NavVoice
  }
  state TeamspaceMenu {
    state "New Teamspace" as TsNew
    state "Create Folder" as TsFolder
    state "Associate Modules" as TsAssoc
    state "Manage CRM Teamspace" as TsManage
    state "View All Teamspace" as TsViewAll
  }
  NavTeamspace --> TeamspaceMenu : click
  ' ── TOP BAR ───────────────────────────────
  state TopBar {
    state "Search Records" as TopSearch
    state "Ask Zia" as TopZia
    state "Signals" as TopSignals
    state "Calendar" as TopCalendar
    state "Marketplace" as TopMarket
    state "Setup" as TopSetup
    state "Profile" as TopProfile
  }
  ' ── CUSTOM VIEW TAB BAR ───────────────────
  state CustomViewTabBar {
    state "All Deals (active)" as CVAllDeals
    state "More Custom Views (dropdown)" as CVMore
    state "New Custom View" as CVNew
    state "Manage Custom View" as CVManage
    state "Show as Dropdown" as CVDropdown
    state "More Options (···) on tab" as CVTabOptions
  }
  CVMore --> CVNew : open
  CVMore --> CVManage : open
  CVMore --> CVDropdown : open
  ' ── TOOLBAR / VIEW CONTROLS ───────────────
  state Toolbar {
    state "Filter Toggle" as TbFilter
    state "Sort" as TbSort
    state "Refresh Custom View" as TbRefresh
    state "View Settings (column config)" as TbSettings
  }
  state ViewTypeToggle {
    state "List View (active)" as VtList
    state "Kanban View" as VtKanban
    state "Grid View (Sheet View)" as VtGrid
    state "Chart View" as VtChart
    state "Timeline View" as VtTimeline
    state "Split View" as VtSplit
    state "More Views Dropdown" as VtMore
    state "Canvas View (in More)" as VtCanvas
    state "Card View (in More)" as VtCard
    state "Table View (in More)" as VtTable
    note right of ViewTypeToggle
      Deals HAS Grid/Sheet View
      (unlike Tasks module).
      Kanban View is specially useful
      for Deals — drag cards between stages.
    end note
  }
  VtMore --> VtCanvas : expand
  VtMore --> VtCard : expand
  VtMore --> VtTable : expand
  ' ── HEADER ACTION BUTTONS ─────────────────
  state HeaderActions {
    state "Create Deal" as HaCreate
    state "More Dropdown (bulk actions + import)" as HaMore
    state "Actions Dropdown (after checkbox select)" as HaActions
  }
  state MoreDropdown {
    state "Import Deals" as MdImport
    state "Mass Delete" as MdMassDelete
    state "Mass Update" as MdMassUpdate
    state "Manage Tags" as MdTags
    state "Drafts" as MdDrafts
    state "Mass Email" as MdMassEmail
    state "Deduplicate Deals" as MdDedup
    state "Create Client Script" as MdClientScript
    state "Export Deals" as MdExport
    state "Zoho Sheet View" as MdSheetView
    state "Print View" as MdPrint
    note right of MoreDropdown
      Deals 'More' menu is rich:
      includes Mass Email, Drafts,
      Deduplicate, Create Client Script,
      Zoho Sheet View.
      NO 'Approve Deals', 'Autoresponders',
      'Import Notes' items in this org.
    end note
  }
  HaMore --> MoreDropdown : click
  state ActionsDropdown {
    state "Mass Delete (selected)" as AdDelete
    state "Mass Update (selected)" as AdUpdate
    state "Manage Tags (selected)" as AdTags
    state "Drafts" as AdDrafts
    state "Mass Email (selected)" as AdEmail
    state "Deduplicate Deals" as AdDedup
    state "Create Client Script" as AdClientScript
    state "Export Deals" as AdExport
    state "Zoho Sheet View" as AdSheetView
    state "Print View" as AdPrint
  }
  HaActions --> ActionsDropdown : click (with/without selection)
  ' ── ADVANCED FILTER PANEL ─────────────────
  state AdvancedFilterPanel {
    state "Search Filter Box" as FpSearch
    AdvancedFilterPanel : ── System Defined Filters ──
    AdvancedFilterPanel : Touched Records
    AdvancedFilterPanel : Untouched Records
    AdvancedFilterPanel : Record Action
    AdvancedFilterPanel : Related Records Action
    AdvancedFilterPanel : Locked
    AdvancedFilterPanel : Latest Email Status
    AdvancedFilterPanel : Activities
    AdvancedFilterPanel : Cadences
    AdvancedFilterPanel : ── Filter By Fields ──
    AdvancedFilterPanel : 1. Preferred Location
    AdvancedFilterPanel : 2. Preferred Location
    AdvancedFilterPanel : 3. Preferred Location
    AdvancedFilterPanel : Ads Form Name / ID
    AdvancedFilterPanel : Ads Lead Created Time / ID
    AdvancedFilterPanel : All Traffic Sources
    AdvancedFilterPanel : Amount
    AdvancedFilterPanel : Approval for Closure
    AdvancedFilterPanel : Attempt
    AdvancedFilterPanel : Authority (BANT)
    AdvancedFilterPanel : BANT Form URL
    AdvancedFilterPanel : BDM / BDM Feedback / BDM Form URL
    AdvancedFilterPanel : Browser
    AdvancedFilterPanel : Budget (BANT)
    AdvancedFilterPanel : Budget Concern Description
    AdvancedFilterPanel : Budget Range / Max / Min
    AdvancedFilterPanel : City (from IP address)
    AdvancedFilterPanel : Client Comments / Feedback / Location / Rating
    AdvancedFilterPanel : Closing Date
    AdvancedFilterPanel : Comfortable Price
    AdvancedFilterPanel : Comments
    AdvancedFilterPanel : Connected To
    AdvancedFilterPanel : Contact Name
    AdvancedFilterPanel : Country (from IP address)
    AdvancedFilterPanel : Created By / Created Time
    AdvancedFilterPanel : Deal Closed Time
    AdvancedFilterPanel : Deal Name
    AdvancedFilterPanel : Deal Owner
    AdvancedFilterPanel : Decision Influencers
    AdvancedFilterPanel : Relevant Property
    AdvancedFilterPanel : (+ many more custom fields)
    AdvancedFilterPanel : ── Filter By Related Modules ──
    AdvancedFilterPanel : Calls
    AdvancedFilterPanel : Deal Contact Role (Contact Roles)
    AdvancedFilterPanel : Deals (Referrals)
    AdvancedFilterPanel : Emails
    AdvancedFilterPanel : Leads (Converted Leads)
    AdvancedFilterPanel : Meetings
    AdvancedFilterPanel : Notes
    AdvancedFilterPanel : Tasks
  }
  TbFilter --> AdvancedFilterPanel : toggle open/close
  ' ── LIST VIEW TABLE ───────────────────────
  state ListViewTable {
    state "Column: Contact Name" as ColContact
    state "Column: Deal Name (All filter)" as ColDealName
    state "Column: Amount" as ColAmount
    state "Column: Stage (colored badge)" as ColStage
    state "Row: Deal record (×N per page)" as ListRow
    state "Row More Options (···)" as RaMore
    state "Edit" as RmEdit
    state "Delete" as RmDelete
    state "Print Default view" as RmPrint
    state "Print Using Canvas" as RmPrintCanvas
    ListRow --> RaMore : hover
    RaMore --> RmEdit : click
    RaMore --> RmDelete : click
    RaMore --> RmPrint : click
    RaMore --> RmPrintCanvas : click
  }
  state KanbanView {
    note "Kanban View for Deals:\n- Columns = Deal Stages\n- Cards = individual Deals\n- Drag card = stage change\n- Click card = open detail\n- Stage column total = sum of Amount\n- 'New Deal' button per column"
  }
  VtKanban --> KanbanView : activate
  ' ── MASS ACTION BAR ───────────────────────
  state MassActionBar {
    note "Visible when 1+ deals checked"
    state "Mass Delete (selected)" as MaDelete
    state "Mass Update (selected)" as MaUpdate
    state "Manage Tags (selected)" as MaTags
    state "Mass Email (selected)" as MaEmail
    state "Export Selected" as MaExport
  }
  ListViewTable --> MassActionBar : check deal row(s)
  ' ── PAGINATION ────────────────────────────
  state Pagination {
    state "Previous Page" as PgPrev
    state "Next Page" as PgNext
    state "Total: 9 records | 1 to 9 shown" as PgInfo
  }
  ' ── BOTTOM RIGHT UTILITY BAR ──────────────
  state UtilityBar {
    state "Visitors Online" as UbVisitors
    state "Feedback on New UI" as UbFeedback
    state "Announcements" as UbAnnouncements
    state "Mail" as UbMail
    state "Motivator" as UbMotivator
    state "Sticky Notes" as UbNotes
    state "Zia Assistant" as UbZia
    state "Activity Reminders" as UbReminders
    state "Recent Items" as UbRecent
    state "Accessibility" as UbAccessibility
    state "Chat Widget" as UbChat
  }
  ' ── MODAL DIALOGS (hidden / contextual) ───
  state ModalDialogs {
    state "Delete Confirmation Modal" as MdlDelete
    state "Mass Update Modal" as MdlMassUpdate
    state "Import Wizard Modal" as MdlImport
    state "Export in Progress Modal" as MdlExport
    state "Deduplicate Modal" as MdlDedup
    state "Leave Page Confirmation" as MdlLeavePage
    state "Cannot Make Call Modal" as MdlCallError
    state "User Limit Reached Modal" as MdlUserLimit
    state "Import Scheduled Confirmation" as MdlImportSched
    state "Lookup Field Max Limit Modal" as MdlLookupLimit
    note right of ModalDialogs
      All lyte-modal dialogs present in DOM
      rendered hidden (lyteMenuClosed)
      until triggered by corresponding action.
    end note
  }
  ' ── BLUEPRINT LIST NOTE ───────────────────
  state BlueprintListNote {
    note "Blueprint state bar not rendered\nin List View. Appears only in Deal\nDetail View when Blueprint is active."
  }
}
' ─────────────────────────────────────────────
' STATE: DEAL DETAIL VIEW
' ─────────────────────────────────────────────
state DealDetailView {
  ' ── DETAIL HEADER ─────────────────────────
  state DetailHeader {
    state "Deal Name - Amount (in header title)" as DhTitle
    state "Back (to Deals list)" as DhBack
    state "Add Tags" as DhTags
    state "Send Email" as DhSendEmail
    state "Edit" as DhEdit
    state "More Options (···)" as DhMore
    state "Previous Record" as DhPrev
    state "Next Record" as DhNext
    note right of DetailHeader
      Deals header shows: Deal Name + Amount
      (e.g. "Prasanth - ₹ 25,00,000.00")
      No "New Appointment" button on Deals
      (unlike Contacts module).
      No "Close Task" button (Tasks-specific).
    end note
  }
  state MoreOptionsMenu {
    state "Clone" as MoClone
    state "Delete" as MoDelete
    state "Print Preview" as MoPrint
    state "Find and Merge Duplicates" as MoMerge
    state "Mail Merge" as MoMailMerge
    state "Run Macro" as MoMacro
    state "Customize Business Card" as MoCustomizeBiz
    state "Organize Deal Details" as MoOrganize
    state "Add Related List" as MoAddRL
    state "Review History" as MoHistory
    state "Enroll to Cadence" as MoEnrollCadence
    state "Add Kiosk" as MoKiosk
    state "Create Button" as MoCreateBtn
    state "Create Client Script" as MoClientScript
    note right of MoreOptionsMenu
      Deals More Options is IDENTICAL in
      structure to Contacts More Options menu
      (14 items), with "Organize Deal Details"
      replacing "Organize Contact Details".

      SCRIBE FLOW CONFIRMED (deals_record_print_preview):
      Path: List view → Click "Prasanth" deal → ⋮ More → Print Preview
      "Print Preview" opens print-formatted record view in new tab.
      Deal "Prasanth" (₹ 25,00,000 — Closed Won) used as example record.
      Custom view ID 955332000000441430 confirmed.
      URL internal name /tab/Potentials/ confirmed.
    end note
  }
  DhMore --> MoreOptionsMenu : click
  ' ── DETAIL VIEW TABS ─────────────────────
  state DetailViewTabs {
    state "Overview (active)" as DvOverview
    state "Timeline" as DvTimeline
  }
  ' ── STAGE PIPELINE BAR (DEALS UNIQUE) ────
  state StagePipelineBar {
    note "DEALS-UNIQUE FEATURE\nVisual stage progress bar at top of detail view.\nShows: START date (left) → CLOSING date (right)\nCurrent stage highlighted in green.\nLost stages shown with thumbs-down icon in red."
    state "START date (deal creation date)" as SpbStart
    state "CLOSING date (expected close date)" as SpbClosing
    StagePipelineBar : ── Active Stages ──
    StagePipelineBar : Stage buttons shown as progress pipeline.
    StagePipelineBar : Current stage = green filled pill.
    StagePipelineBar : Past stages = checkmark.
    StagePipelineBar : Future stages = empty pill.
    StagePipelineBar : Lost stages = red thumbs-down pill.
    state "Thumbs Up dropdown (mark as Won)" as SpaThumsbUp
    state "Thumbs Down dropdown (mark as Lost)" as SpaThumsbDown
    state "Closed Won" as TuClosed
    state "Closed Lost" as TdLost
    state "Closed Lost to Competition" as TdLostComp
    SpaThumsbUp --> TuClosed : click
    SpaThumsbDown --> TdLost : click
    SpaThumsbDown --> TdLostComp : click
    StagePipelineBar : ── Stage Pipeline Actions ──
    StagePipelineBar : Thumbs Up → Closed Won (probability 100%, auto-sets Deal Closed Time)
    StagePipelineBar : Thumbs Down → Closed Lost / Closed Lost to Competition
    StagePipelineBar : (May prompt for Lost Reason, probability 0%, auto-sets Deal Closed Time)
    StagePipelineBar : ── Stage Click Transition ──
    StagePipelineBar : Click any stage pill in the bar
    StagePipelineBar : → Deal stage changes immediately
    StagePipelineBar : → Probability auto-updated
    StagePipelineBar : → Stage History entry written
    StagePipelineBar : → Timeline event logged
    StagePipelineBar : → Workflow Rules re-evaluate
  }
  ' ── BUSINESS CARD SUMMARY ────────────────
  state BusinessCardSummary {
    state "Deal Owner" as BcOwner
    state "Stage (colored badge)" as BcStage
    state "Probability (%)" as BcProbability
    state "Expected Revenue (computed = Amount × Probability)" as BcExpRevenue
    state "Closing Date" as BcClosingDate
    state "Last Update timestamp" as BcLastUpdate
  }
  ' ── CONTACT PERSON CARD ──────────────────
  state ContactPersonCard {
    state "Contact Name link" as CpcName
    state "Role badge (e.g. Purchasing)" as CpcRole
    state "Mobile phone with call icon" as CpcPhone
    state "More Info link (opens Contact detail)" as CpcMoreInfo
  }
  ' ── NEXT ACTION WIDGET ───────────────────
  state NextActionWidget {
    state "Overdue date badge (red)" as NaDate
    state "Task/Cadence name link" as NaLink
    note "Shows next overdue task or cadence action\nLinked to full Task/Meeting record"
  }
  ' ── OVERVIEW PANEL SECTIONS ──────────────
  state OverviewPanel {
    state "Hide/Show Details Toggle" as OvToggle
    OverviewPanel : ── Deal Information ──
    OverviewPanel : Deal Name
    OverviewPanel : Closing Date
    OverviewPanel : Stage (badge)
    OverviewPanel : Probability (%)
    OverviewPanel : Expected Revenue
    OverviewPanel : Budget Range
    OverviewPanel : Contact Name (link)
    OverviewPanel : Amount
    OverviewPanel : Estimated Budget
    OverviewPanel : Deal Closed Time
    OverviewPanel : Deal Owner
    OverviewPanel : ── Lead Assessment (BANT) ──
    OverviewPanel : Budget (BANT)
    OverviewPanel : Need (BANT)
    OverviewPanel : Authority (BANT)
    OverviewPanel : Time (BANT)
    OverviewPanel : Budget Range Max
    OverviewPanel : Budget Range Min
    OverviewPanel : ── Description ──
    OverviewPanel : Description (text)
    OverviewPanel : Client Feedback after Site Visit
    OverviewPanel : BDM Feedback
    OverviewPanel : ── Qualification Form ──
    OverviewPanel : Does lead have financial capability?
    OverviewPanel : Does project match location preference?
    OverviewPanel : Who is making the purchase decision?
    OverviewPanel : When is lead planning to buy?
    OverviewPanel : ── Client Feedback ──
    OverviewPanel : Feedback URL
    OverviewPanel : Comments
    OverviewPanel : Client Rating
    OverviewPanel : ── Team Lead Section ──
    OverviewPanel : Approval for Closure
    OverviewPanel : ── Site Visit Information ──
    OverviewPanel : Site Visit URL
    OverviewPanel : Visit Status
    OverviewPanel : Client Comments
    OverviewPanel : Site Visit Location
    OverviewPanel : BDM Form URL
    OverviewPanel : Site Visit Date
    OverviewPanel : When Are You Planning to Start
    OverviewPanel : BDM
    OverviewPanel : Is There Any Other Specific Concerns
    OverviewPanel : Visit Date
    OverviewPanel : Client's Overall Impression
    OverviewPanel : Real Objections
    OverviewPanel : Decision Influencers
  }
  ' ── SALES SUMMARY PANEL (DEALS UNIQUE) ───
  state SalesSummaryPanel {
    state "Lead Conversion Time" as SspConvTime
    state "Sales Cycle Duration" as SspCycleDur
    state "Overall Sales Duration" as SspOverallDur
    note right of SalesSummaryPanel
      DEALS-UNIQUE FEATURE in left sidebar.
      Shows calculated metrics for the deal:
      - Lead Conversion Time: Lead created → Deal created
      - Sales Cycle Duration: Deal created → Deal closed
      - Overall Sales Duration: Lead created → Deal closed
    end note
  }
  ' ── TIMELINE PANEL ────────────────────────
  state TimelinePanel {
    TimelinePanel : ── Timeline Sub-Tabs ──
    TimelinePanel : History (only tab)
    TimelinePanel : Note: Deals Timeline has ONLY History tab.
    TimelinePanel : Like Tasks, NO 'Interactions' tab.
    TimelinePanel : Unlike Contacts which has both.
    state "Timeline Filter Button" as TlFilter
    state "0 Upcoming Automated Actions (expandable)" as TlUpcoming
    state "Event: Deal created by converting the Lead" as TlEvtCreate
    state "View Lead History link" as TlViewLeadHistory
    state "Event: Task added via Function [Lead] Send Welcome Message" as TlEvtFunction
    state "Event: Stage changed from X to Y" as TlEvtStage
    state "Event: Field edited (field-level diff)" as TlEvtEdit
    state "Event: Deal Owner changed" as TlEvtOwner
    state "Event: Amount updated" as TlEvtAmount
    state "Event: Note added" as TlEvtNote
    state "Event: Task added / completed" as TlEvtTask
    state "Event: Email sent / received" as TlEvtEmail
    state "Event: Cadence enrolled / action" as TlEvtCadence
    TimelinePanel : ── Timeline Filter Options ──
    TimelinePanel : Modules dropdown (All Modules)
    TimelinePanel : Users dropdown (All / Active / Inactive / Deleted)
    TimelinePanel : Time filter (Any Time / Today / Yesterday / Last 7/30 days / Custom / Specific)
    TimelinePanel : Sources dropdown (All Sources)
    TimelinePanel : ── Upcoming Automated Actions ──
    TimelinePanel : Pending Workflow Rules
    TimelinePanel : Pending Scheduled Actions
    TimelinePanel : Pending Functions
  }
  ' ── BLUEPRINT STATE BAR (CONDITIONAL) ────
  state BlueprintStateBarDetail {
    note "Blueprint state bar renders HERE in Detail View\nwhen a Blueprint process is active on this Deal.\n\nNOT currently active on scanned Deal record\nin this org.\n\nWhen active renders:\n  - Current Blueprint State name\n  - Transition buttons (e.g. Qualify → Propose → Negotiate)\n  - Locked field indicators (padlock icon)\n  - Pre-transition required field validation\n  - Notes/reason field for transition\n  - Auto-logs each transition to Timeline History\n  - Can control Stage field via Blueprint transitions"
  }
  ' ── RELATED LISTS PANEL ──────────────────
  state RelatedListsPanel {
    RelatedListsPanel : ── Notes ──
    RelatedListsPanel : Add a note (inline textarea)
    RelatedListsPanel : Note row: Edit
    RelatedListsPanel : Note row: Delete
    RelatedListsPanel : ── Connected Records ──
    RelatedListsPanel : Add New (dropdown)
    RelatedListsPanel : ── Attachments ──
    RelatedListsPanel : Attach dropdown: Upload File
    RelatedListsPanel : Attach dropdown: Zoho WorkDrive
    RelatedListsPanel : Attach dropdown: Other Cloud Drives
    RelatedListsPanel : Attach dropdown: Link (URL)
    RelatedListsPanel : ── Stage History (DEALS-UNIQUE) ──
    RelatedListsPanel : Audit trail of all stage changes.
    RelatedListsPanel : Columns: Stage, Amount, Probability (%),
    RelatedListsPanel : Expected Revenue, Closing Date,
    RelatedListsPanel : Stage Duration (Calendar Days),
    RelatedListsPanel : Modified Time, Modified By.
    RelatedListsPanel : Read-only / no add action.
    RelatedListsPanel : Show Customize List Popup (column selector)
    RelatedListsPanel : ── Competitors (DEALS-UNIQUE) ──
    RelatedListsPanel : New (add competitor)
    RelatedListsPanel : Competitor row: Name, Strengths, Weaknesses
    RelatedListsPanel : Competitor row: Edit
    RelatedListsPanel : Competitor row: Delete
    RelatedListsPanel : Track competing products/companies.
    RelatedListsPanel : ── Cadences ──
    RelatedListsPanel : Enroll
    RelatedListsPanel : Un-enroll
    RelatedListsPanel : Cadence row: Name, Status, Next Action
    RelatedListsPanel : ── Open Activities ──
    RelatedListsPanel : Add New dropdown: Task
    RelatedListsPanel : Add New dropdown: Meeting
    RelatedListsPanel : Add New dropdown: Call
    RelatedListsPanel : Column View / Tab View / Chronological View
    RelatedListsPanel : Open Tasks count
    RelatedListsPanel : Open Meetings count
    RelatedListsPanel : Open Calls count
    RelatedListsPanel : ── Closed Activities ──
    RelatedListsPanel : Closed Task rows
    RelatedListsPanel : Closed Call rows
    RelatedListsPanel : Closed Meeting rows
    RelatedListsPanel : ── Contact Roles (DEALS-UNIQUE) ──
    RelatedListsPanel : Multiple contacts linked to a single deal
    RelatedListsPanel : with their role in the purchase decision.
    RelatedListsPanel : Add Contacts Roles
    RelatedListsPanel : Edit All
    RelatedListsPanel : Show Customize List Popup
    RelatedListsPanel : Contact Role row: Contact, Role, Decision Maker, Phone, Email
    RelatedListsPanel : Unassign (remove role)
    RelatedListsPanel : ── Emails ──
    RelatedListsPanel : Compose Email button
    RelatedListsPanel : Mails tab
    RelatedListsPanel : Drafts tab
    RelatedListsPanel : Scheduled tab
    RelatedListsPanel : Email row: Reply / Delete
    RelatedListsPanel : ── Zoho Projects ──
    RelatedListsPanel : New Project
    RelatedListsPanel : Associate Project
    RelatedListsPanel : ── Zoho Desk ──
    RelatedListsPanel : All Tickets / Overdue / High Priority filters
    RelatedListsPanel : Ticket row: Update Field
    RelatedListsPanel : Ticket row: Close
    RelatedListsPanel : Ticket row: Delete
    RelatedListsPanel : ── Documents ──
    RelatedListsPanel : Document library integration (Zoho WorkDrive linked docs)
    RelatedListsPanel : ── Referrals (DEALS-UNIQUE) ──
    RelatedListsPanel : Track referral relationships between deals.
    RelatedListsPanel : Assign (link a referral)
    RelatedListsPanel : New Deal (from referral)
    RelatedListsPanel : Edit referral row
    RelatedListsPanel : ── Links Section ──
    RelatedListsPanel : Workdrive link
    RelatedListsPanel : Add Link
    RelatedListsPanel : ── Add Related List Button ──
    RelatedListsPanel : Add optional related lists from available CRM modules
  }
}
' ─────────────────────────────────────────────
' STATE: CREATE DEAL FORM
' ─────────────────────────────────────────────
state CreateDealForm {
  CreateDealForm : ── Form Sections ──
  CreateDealForm : Deal Information section
  CreateDealForm : Lead Assessment section (BANT)
  CreateDealForm : Description Information section
  CreateDealForm : Qualification Form section
  CreateDealForm : Client Feedback section
  CreateDealForm : Team Lead Section
  CreateDealForm : Site Visit Infomation section
  CreateDealForm : ── Deal Information Fields ──
  CreateDealForm : Deal Name (required)
  CreateDealForm : Closing Date (required)
  CreateDealForm : Stage (picklist, required)
  CreateDealForm : Contact Name (lookup)
  CreateDealForm : Amount
  CreateDealForm : Probability (%) - auto-set by stage
  CreateDealForm : Expected Revenue (computed = Amount × Probability)
  CreateDealForm : Deal Owner (user lookup)
  CreateDealForm : Account Name (lookup)
  CreateDealForm : Lead Source (picklist)
  CreateDealForm : Campaign Source
  CreateDealForm : Comfortable Price
  CreateDealForm : Relevant Property
  CreateDealForm : Estimated Budget
  CreateDealForm : ── Lead Assessment Fields (BANT) ──
  CreateDealForm : Budget (BANT picklist)
  CreateDealForm : Need (BANT picklist)
  CreateDealForm : Authority (BANT picklist)
  CreateDealForm : Time (BANT picklist)
  CreateDealForm : Budget Range Max
  CreateDealForm : Budget Range Min
  CreateDealForm : ── Description Fields ──
  CreateDealForm : Description (textarea)
  CreateDealForm : Client Feedback after the Site Visit (textarea)
  CreateDealForm : BDM Feedback (textarea)
  CreateDealForm : ── Qualification Fields ──
  CreateDealForm : Does lead have financial capability? (checkbox)
  CreateDealForm : Does project match location preference? (dropdown)
  CreateDealForm : Who is making the decision? (dropdown)
  CreateDealForm : When is lead planning to buy? (dropdown)
  CreateDealForm : ── Client Feedback Fields ──
  CreateDealForm : Feedback URL
  CreateDealForm : Comments (textarea)
  CreateDealForm : Client Rating
  CreateDealForm : ── Team Lead Fields ──
  CreateDealForm : Approval for Closure (checkbox/picklist)
  CreateDealForm : ── Site Visit Fields ──
  CreateDealForm : Site Visit URL
  CreateDealForm : Visit Status
  CreateDealForm : Client Comments
  CreateDealForm : Site Visit Location
  CreateDealForm : BDM Form URL
  CreateDealForm : Site Visit Date
  CreateDealForm : When Are You Planning to Start
  CreateDealForm : BDM
  CreateDealForm : Is There Any Other Specific Concerns
  CreateDealForm : Visit Date
  CreateDealForm : Client's Overall Impression
  CreateDealForm : Real Objections
  CreateDealForm : Decision Influencers
  CreateDealForm : ── Form Actions ──
  CreateDealForm : Save
  CreateDealForm : Save and New
  CreateDealForm : Cancel
  CreateDealForm : Edit Page Layout link
  note right of CreateDealForm
    Deal Name, Closing Date, Stage are required.
    Probability auto-updates when Stage changes.
    Expected Revenue = Amount × (Probability / 100).
    Deal Closed Time auto-stamps when stage = Closed Won/Lost.
    Triggered from:
    - Header 'Create Deal' button
    - Lead Conversion flow (Deal checkbox)
    - Related list 'New Deal' from Contact/Account
    - Referrals 'New Deal' action
    - Kanban 'Add Deal' per column
    - Clone existing deal
    - Workflow / Blueprint auto-create
    - API / Integration
  end note
}
' ─────────────────────────────────────────────
' STATE: EDIT DEAL FORM
' ─────────────────────────────────────────────
state EditDealForm {
  EditDealForm : ── Edit Form Sections ──
  EditDealForm : All same sections as Create form:
  EditDealForm : Deal Information, Lead Assessment, Description,
  EditDealForm : Qualification Form, Client Feedback,
  EditDealForm : Team Lead Section, Site Visit Infomation
  EditDealForm : ── Edit Form Actions ──
  state "Save" as EcSave
  state "Save and New" as EcSaveNew
  state "Cancel" as EcCancel
  state "Edit Page Layout link" as EcEditLayout
  EditDealForm : ── Inline Edit Support ──
  EditDealForm : All fields support inline edit
  EditDealForm : directly from Detail View
  EditDealForm : by clicking any field value
  EditDealForm : ── Change Owner In Edit ──
  state "Deal Owner field (user lookup)" as EcOwnerField
  state "Search and select new owner" as EcOwnerSearch
  state "Confirm new owner" as EcOwnerConfirm
  EditDealForm : ── Stage Change In Edit ──
  state "Stage picklist in form" as EcStageField
  state "Select new stage" as EcStageSelect
  state "Probability auto-updates" as EcProbUpdate
  state "Expected Revenue recalculates" as EcRevCalc
  state "On Save: Stage History entry written" as EcStageHistory
  state "On Save: Timeline event logged" as EcTimeline
  state "On Save: Workflow Rules re-evaluate" as EcWorkflow
  EcStageField --> EcStageSelect
  EcStageSelect --> EcProbUpdate
  EcProbUpdate --> EcRevCalc
  note right of EditDealForm
    Edit form opens with all existing field values.
    Accessed via:
    - 'Edit' button on Detail View
    - Inline field click in Detail View
    - Row-level Edit action in List View
    - Mass Update tool (multiple records)
    Stage change in edit form:
    - Probability auto-sets per stage mapping
    - Expected Revenue recalculates
    - On Save: Stage History entry created
    - If Closed Won/Lost: Deal Closed Time stamped
  end note
}
' ─────────────────────────────────────────────
' FULL DEAL RECORD LIFECYCLE STATES
' ─────────────────────────────────────────────
state DealLifecycle {
  [*] --> DealNotExists
  state DealNotExists {
    note "No deal record exists yet"
  }
  state DealCreated {
    note "Created via:\n- Create Deal form (manual)\n- Lead Conversion (contact + account + deal)\n- Clone existing deal\n- Import (CSV / Excel)\n- API / Integration\n- Workflow Rule auto-create\n- Blueprint transition auto-create\n- Function (Deluge script)\n- Referral → New Deal action\n- Related list 'New Deal' from Contact/Account"
  }
  state DealQualification {
    note "Stage: Qualification / Needs Analysis\n(custom stage names per org config)\nBANT fields assessed:\n- Budget, Authority, Need, Time"
  }
  state DealProposal {
    note "Stage: Value Proposition / Proposal/Price Quote\nProposal sent to prospect.\nSite Visit may be scheduled."
  }
  state DealNegotiation {
    note "Stage: Negotiation / Review\nPrice and terms negotiated.\nApproval for Closure may be triggered."
  }
  state DealClosedWon {
    note "Stage: Closed Won\nProbability = 100%\nDeal Closed Time auto-stamped\nExpected Revenue = Amount\nSales Cycle Duration computed\nWorkflow / Blueprint triggers fire\nStage History entry created"
  }
  state DealClosedLost {
    note "Stage: Closed Lost\nProbability = 0%\nDeal Closed Time auto-stamped\nLost Reason may be captured\nStage History entry created"
  }
  state DealClosedLostToCompetition {
    note "Stage: Closed Lost to Competition\nProbability = 0%\nCompetitor tracked in Competitors list\nDeal Closed Time auto-stamped\nStage History entry created"
  }
  state DealDeleted {
    note "Soft-deleted.\nMoves to Recycle Bin.\nRetained up to 60 days.\nRelated records orphaned or cleaned per config."
  }
  state DealPermanentlyDeleted {
    note "Permanent deletion:\n- Manual from Recycle Bin\n- 60-day auto-purge\n- Mass Delete Permanently"
  }
  state DealMerged {
    note "Result of Find and Merge Duplicates.\nMaster record survives.\nDuplicate merged-deleted.\nRelated records re-parented to master."
  }
  DealNotExists --> DealCreated : Create / Import / Workflow / API
  DealCreated --> DealQualification : enter Qualification stage
  DealQualification --> DealProposal : stage progressed
  DealProposal --> DealNegotiation : negotiation stage
  DealNegotiation --> DealClosedWon : Closed Won
  DealNegotiation --> DealClosedLost : Closed Lost
  DealNegotiation --> DealClosedLostToCompetition : Lost to Competition
  DealQualification --> DealClosedLost : Qualify Out
  DealClosedWon --> [*]
  DealClosedLost --> [*]
  DealClosedLostToCompetition --> [*]
  DealCreated --> DealDeleted : Delete
  DealQualification --> DealDeleted : Delete
  DealNegotiation --> DealDeleted : Delete
  DealClosedWon --> DealDeleted : Delete
  DealDeleted --> DealNotExists : Restore from Recycle Bin
  DealDeleted --> DealPermanentlyDeleted : permanent delete / 60-day purge
  DealCreated --> DealMerged : Find and Merge Duplicates
  DealQualification --> DealMerged : Find and Merge Duplicates
}
DealsListView --> DealDetailView : click Deal Name link
DealsListView --> CreateDealForm : click Create Deal
DealDetailView --> EditDealForm : click Edit
DealDetailView --> DealsListView : Back
CreateDealForm --> DealDetailView : Save
CreateDealForm --> DealsListView : Cancel
EditDealForm --> DealDetailView : Save or Cancel
@enduml
